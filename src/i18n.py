# src/i18n.py

TRANSLATIONS = {
    "zh": {
        "app_title": "论文抓取与管理平台 (重构版)",
        "settings": "设置",
        "search_mode": "搜索模式",
        "by_category": "按分类",
        "by_keyword": "按关键词",
        "arxiv_categories": "arXiv 分类",
        "biorxiv_categories": "bioRxiv 分类",
        "keywords_label": "关键词 (每行一个)",
        "advanced_settings": "高级设置",
        "authors_label": "作者 (每行一个)",
        "start_date": "开始日期",
        "end_date": "结束日期",
        "keyword_search_field": "关键词搜索范围",
        "all_fields": "所有字段",
        "title_only": "仅标题",
        "abstract_only": "仅摘要",
        "max_results_keyword": "关键词模式最大获取数",
        "max_results_category": "分类模式每类最大获取数",
        "arxiv_id_search_label": "arXiv ID 精确搜索 (覆盖其他)",
        "arxiv_id_search_placeholder": "每行一个ID, e.g., 2305.08721",
        "arxiv_sort_by": "arXiv 排序方式",
        "submitted_date": "提交日期",
        "relevance": "相关性",
        "last_updated_date": "最后更新",
        "arxiv_sort_order": "arXiv 排序顺序",
        "descending": "降序",
        "ascending": "升序",
        "start_fetching": "开始抓取",
        "toggle_settings_panel": "切换设置面板",
        "select_all": "全选",
        "batch_download": "批量下载",
        "batch_delete": "批量删除",
        "clear_new_entries": "清除新条目",
        "all_categories": "所有类别",
        "status_fetching": "抓取中...",
        "status_ready": "就绪",
        "status_init_failed": "初始化失败",
        "status_connected": "已连接",
        "no_papers_in_category": "没有在 “{category}” 中的论文。",
        "paper_details": "论文详情",
        "details_placeholder": "从左侧列表选择一篇论文以查看详情",
        "download": "下载",
        "open_file": "打开文件",
        "open_folder": "打开所在文件夹",
        "status_downloaded": "已下载",
        "open_in_browser": "在浏览器中打开",
        "no_abstract": "无摘要信息。",
        "no_abstract_text": "无摘要信息。",
        "status_new": "新发现",
        "status_new_title": "新发现",
        "status_failed": "下载失败",
        "status_failed_title": "下载失败",
        "status_downloaded_title": "已下载",
        "open_in_browser_btn": "在浏览器中打开",
        "confirm_delete_papers": "确定要删除选中的 {count} 篇论文吗？此操作将删除数据库记录和本地文件，且不可恢复。",
        "confirm_clear_new": "确定要清除 {count} 个新发现的条目吗？",
        "alert_no_papers_to_delete": "请选择已下载的论文进行删除。",
        "alert_no_new_entries": "没有可清除的新条目。",
        "delete_failed_msg": "删除失败: {msg}",
        "open_failed_msg": "打开 {target} 失败",
        "loading": "加载中...",
        "lang_switch": "语言 (Language)",
        "lang_zh": "中文",
        "lang_en": "English",
        "cli_description": "一个用于抓取科研论文的命令行工具。",
        "cli_config_help": "配置文件的路径。",
        "cli_mode_help": "设置抓取模式。'interactive' 将启动引导式会话。",
        "cli_lang_help": "设置界面语言 (en/zh)。",
        "cli_config_loaded": "配置已从 '{path}' 加载。",
        "cli_config_not_found": "配置文件未找到: {e}",
        "cli_config_load_error": "加载配置时出错: {e}",
        "cli_executing_crawl": "执行抓取: {method}",
        "cli_no_new_papers": "没有找到需要下载的新论文。",
        "cli_start_download": "开始下载 {count} 篇新论文",
        "cli_downloading": "下载中...",
        "cli_downloading_paper": "正在下载: {title}",
        "cli_all_tasks_complete": "所有任务完成。",
        "cli_done": "完成",
        "cli_interactive_mode": "交互模式",
        "cli_welcome": "欢迎！您希望如何运行抓取工具？",
        "cli_quick_mode": "快速模式 - 使用 config.yaml 中的设置",
        "cli_preset_mode": "预设模式 - 为本次运行交互式地选择设置",
        "cli_exit": "退出",
        "cli_exiting": "正在退出。",
        "cli_preset_mode_setup": "开始预设模式设置...",
        "cli_choose_fetch_mode": "首先，请选择一个抓取模式:",
        "cli_mode_category": "分类 - 从指定的科学分类中抓取论文",
        "cli_mode_keyword": "关键词 - 使用关键词列表抓取论文",
        "cli_fetching_categories": "正在获取可用分类...",
        "cli_prompt_select": "使用 [空格键] 选择/取消选择，[回车键] 确认。",
        "cli_select_arxiv": "选择 arXiv 分类:",
        "cli_select_biorxiv": "选择 bioRxiv 分类:",
        "cli_enter_keywords": "请输入关键词，每行一个。完成后按 [ESC] 再按 [回车键]。",
        "cli_keywords_prompt": "关键词:",
        "cli_keywords_validate": "请输入至少一个关键词。",
        "cli_run_config": "本次运行的配置:",
        "cli_confirm_proceed": "继续抓取吗？",
        "cli_crawl_cancelled": "抓取已被用户取消。"
    },
    "en": {
        "app_title": "Paper Fetching and Management Platform (Refactored)",
        "settings": "Settings",
        "search_mode": "Search Mode",
        "by_category": "By Category",
        "by_keyword": "By Keyword",
        "arxiv_categories": "arXiv Categories",
        "biorxiv_categories": "bioRxiv Categories",
        "keywords_label": "Keywords (one per line)",
        "advanced_settings": "Advanced Settings",
        "authors_label": "Authors (one per line)",
        "start_date": "Start Date",
        "end_date": "End Date",
        "keyword_search_field": "Keyword Search Field",
        "all_fields": "All Fields",
        "title_only": "Title Only",
        "abstract_only": "Abstract Only",
        "max_results_keyword": "Max Results (Keyword Mode)",
        "max_results_category": "Max Results per Category",
        "arxiv_id_search_label": "arXiv ID Search (Overrides others)",
        "arxiv_id_search_placeholder": "One ID per line, e.g., 2305.08721",
        "arxiv_sort_by": "arXiv Sort By",
        "submitted_date": "Submitted Date",
        "relevance": "Relevance",
        "last_updated_date": "Last Updated Date",
        "arxiv_sort_order": "arXiv Sort Order",
        "descending": "Descending",
        "ascending": "Ascending",
        "start_fetching": "Start Fetching",
        "toggle_settings_panel": "Toggle Settings Panel",
        "select_all": "Select All",
        "batch_download": "Batch Download",
        "batch_delete": "Batch Delete",
        "clear_new_entries": "Clear New Entries",
        "all_categories": "All Categories",
        "status_fetching": "Fetching...",
        "status_ready": "Ready",
        "status_init_failed": "Initialization Failed",
        "status_connected": "Connected",
        "no_papers_in_category": "No papers found in “{category}”.",
        "paper_details": "Paper Details",
        "details_placeholder": "Select a paper from the list to see details",
        "download": "Download",
        "open_file": "Open File",
        "open_folder": "Open Folder",
        "status_downloaded": "Downloaded",
        "open_in_browser": "Open in Browser",
        "no_abstract_text": "No abstract available.",
        "status_new_title": "New",
        "status_downloaded_title": "Downloaded",
        "status_failed_title": "Failed",
        "open_in_browser_btn": "Open in Browser",
        "no_abstract": "No abstract available.",
        "status_new": "New",
        "status_failed": "Failed",
        "confirm_delete_papers": "Are you sure you want to delete the selected {count} paper(s)? This action will remove database records and local files, and cannot be undone.",
        "confirm_clear_new": "Are you sure you want to clear {count} new entries?",
        "alert_no_papers_to_delete": "Please select downloaded papers to delete.",
        "alert_no_new_entries": "No new entries to clear.",
        "delete_failed_msg": "Delete failed: {msg}",
        "open_failed_msg": "Failed to open {target}",
        "loading": "Loading...",
        "lang_switch": "Language",
        "lang_zh": "中文",
        "lang_en": "English",
        "cli_description": "A command-line tool for fetching scientific papers.",
        "cli_config_help": "Path to the configuration file.",
        "cli_mode_help": "Set the fetch mode. 'interactive' will start a guided session.",
        "cli_lang_help": "Set the UI language (en/zh).",
        "cli_config_loaded": "Configuration loaded from '{path}'.",
        "cli_config_not_found": "Configuration file not found: {e}",
        "cli_config_load_error": "Error loading configuration: {e}",
        "cli_executing_crawl": "Executing Crawl: {method}",
        "cli_no_new_papers": "No new papers found to download.",
        "cli_start_download": "Starting download of {count} new paper(s)",
        "cli_downloading": "Downloading...",
        "cli_downloading_paper": "Downloading: {title}",
        "cli_all_tasks_complete": "All tasks completed.",
        "cli_done": "Done",
        "cli_interactive_mode": "Interactive Mode",
        "cli_welcome": "Welcome! How would you like to run the crawler?",
        "cli_quick_mode": "Quick Mode - Use settings from config.yaml",
        "cli_preset_mode": "Preset Mode - Interactively choose settings for this run",
        "cli_exit": "Exit",
        "cli_exiting": "Exiting.",
        "cli_preset_mode_setup": "Starting Preset Mode Setup...",
        "cli_choose_fetch_mode": "First, choose a fetch mode:",
        "cli_mode_category": "Category - Fetch papers from specific scientific categories",
        "cli_mode_keyword": "Keyword - Fetch papers using a list of keywords",
        "cli_fetching_categories": "Fetching available categories...",
        "cli_prompt_select": "Use [spacebar] to select/deselect, [enter] to confirm.",
        "cli_select_arxiv": "Select arXiv categories:",
        "cli_select_biorxiv": "Select bioRxiv categories:",
        "cli_enter_keywords": "Enter keywords, one per line. Press ESC followed by Enter when done.",
        "cli_keywords_prompt": "Keywords:",
        "cli_keywords_validate": "Please enter at least one keyword.",
        "cli_run_config": "Configuration for this run:",
        "cli_confirm_proceed": "Proceed with crawling?",
        "cli_crawl_cancelled": "Crawl cancelled by user."
    }
}

# A simple cache for the current language's translations
_cache = {}

def get_translation(lang="en"):
    """
    Returns the translation dictionary for the given language.
    Defaults to English if the language is not found.
    """
    global _cache
    if lang not in _cache:
        # Get the base translation
        translation = TRANSLATIONS.get(lang, TRANSLATIONS["en"])
        # If the selected lang is not English, merge it with English
        # to ensure all keys are present (fallback).
        if lang != "en":
            base = TRANSLATIONS["en"].copy()
            base.update(translation)
            _cache[lang] = base
        else:
            _cache[lang] = translation
    return _cache[lang]
